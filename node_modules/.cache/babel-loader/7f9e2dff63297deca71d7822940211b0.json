{"ast":null,"code":"import _slicedToArray from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _defineProperty from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _asyncToGenerator from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/node_modules/@babel/runtime/helpers/esm/createClass.js\";import{CURRENT_SEMESTER,DO_LOG_DATA,DO_LOG_MOUSE_DATA,ENABLE_FIREBASE,GRANULARITY,MAX_BUFFER_SIZE}from\"../config/config.js\";import{initializeApp}from\"firebase/app\";import{arrayUnion,doc,getFirestore,serverTimestamp,setDoc}from\"firebase/firestore\";import daysSinceEpoch from\"../util/daysSinceEpoch\";import{IS_PRODUCTION,IS_STAGING_CONTENT,IS_STAGING_OR_DEVELOPMENT,IS_STAGING_PLATFORM}from\"../util/getBuildType\";var problemSubmissionsOutput=\"problemSubmissions\";var problemStartLogOutput=\"problemStartLogs\";var GPTExperimentOutput=\"GPTExperimentOutput\";var feedbackOutput=\"feedbacks\";var siteLogOutput=\"siteLogs\";var focusStatus=\"focusStatus\";var Firebase=/*#__PURE__*/function(){function Firebase(oats_user_id,credentials,treatment,siteVersion,ltiContext){_classCallCheck(this,Firebase);if(!ENABLE_FIREBASE){console.debug(\"Not using firebase for logging\");return;}var app=initializeApp(credentials);this.oats_user_id=oats_user_id;this.db=getFirestore(app);this.treatment=treatment;this.siteVersion=siteVersion;this.mouseLogBuffer=[];this.ltiContext=ltiContext;}_createClass(Firebase,[{key:\"getCollectionName\",value:function getCollectionName(targetCollection){var cond1=IS_STAGING_CONTENT&&[feedbackOutput,siteLogOutput].includes(targetCollection);var cond2=IS_STAGING_PLATFORM&&[siteLogOutput].includes(targetCollection);return targetCollection;}/**\n     * Instead of creating a new doc, pushes to an array instead.\n     * @param _collection\n     * @param documentId\n     * @param arrField\n     * @param data\n     * @param doPartitioning partition data into a sub-collection's documents (for large amount of data)\n     * @param partitionFn\n     * @returns {Promise<void>}\n     */},{key:\"pushDataToArr\",value:function(){var _pushDataToArr=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_collection,documentId,arrField,data){var doPartitioning,partitionFn,collection,payload,path,docRef,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:doPartitioning=_args.length>4&&_args[4]!==undefined?_args[4]:false;partitionFn=_args.length>5&&_args[5]!==undefined?_args[5]:daysSinceEpoch;if(ENABLE_FIREBASE){_context.next=4;break;}return _context.abrupt(\"return\");case 4:collection=this.getCollectionName(_collection);payload=this.addMetaData(data,true);if(IS_STAGING_OR_DEVELOPMENT){console.debug(\"Upserting document: \".concat(documentId,\", with \").concat(data));}path=[this.db,collection,documentId];if(doPartitioning){path.push(\"partitions\",partitionFn().toString());}docRef=doc.apply(void 0,path);_context.next=12;return setDoc(docRef,_defineProperty({},arrField,arrayUnion(payload)),{merge:true}).catch(function(err){console.log(\"a non-critical error occurred.\");console.debug(err);});case 12:case\"end\":return _context.stop();}}},_callee,this);}));function pushDataToArr(_x,_x2,_x3,_x4){return _pushDataToArr.apply(this,arguments);}return pushDataToArr;}()/*\n      Collection: Collection of Key/Value pairs\n      Document: Key - How you will access this data later. Usually username\n      Data: Value - JSON object of data you want to store\n    */},{key:\"writeData\",value:function(){var _writeData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_collection,data){var collection,payload;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(ENABLE_FIREBASE){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:collection=this.getCollectionName(_collection);payload=this.addMetaData(data);if(IS_STAGING_OR_DEVELOPMENT){// console.log(\"payload: \", payload);\nconsole.debug(\"Writing this payload to firebase: \",payload);}_context2.next=7;return setDoc(doc(this.db,collection,this._getReadableID()),payload).catch(function(err){console.log(\"a non-critical error occurred.\");console.log(\"Error is: \",err);console.debug(err);});case 7:case\"end\":return _context2.stop();}}},_callee2,this);}));function writeData(_x5,_x6){return _writeData.apply(this,arguments);}return writeData;}()/**\n     *\n     * @param data\n     * @param isArrayElement if true, cannot use FieldValue methods like serverTimestamp()\n     * @returns {{[p: string]: *}}\n     */},{key:\"addMetaData\",value:function addMetaData(data){var _this$ltiContext;var isArrayElement=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _payload=_objectSpread(_objectSpread(_objectSpread(_objectSpread({semester:CURRENT_SEMESTER,siteVersion:this.siteVersion,siteCommitHash:process.env.REACT_APP_COMMIT_HASH,oats_user_id:this.oats_user_id,treatment:this.treatment,time_stamp:Date.now()},process.env.REACT_APP_STUDY_ID?{study_id:process.env.REACT_APP_STUDY_ID}:{}),!isArrayElement?{server_time:serverTimestamp()}:{}),(_this$ltiContext=this.ltiContext)!==null&&_this$ltiContext!==void 0&&_this$ltiContext.user_id?{course_id:this.ltiContext.course_id,course_name:this.ltiContext.course_name,course_code:this.ltiContext.course_code,lms_user_id:this.ltiContext.user_id}:{course_id:\"n/a\",course_name:\"n/a\",course_code:\"n/a\",lms_user_id:\"n/a\"}),data);return Object.fromEntries(Object.entries(_payload).map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],val=_ref2[1];return[key,typeof val===\"undefined\"?null:val];}));}},{key:\"_getReadableID\",value:function _getReadableID(){var today=new Date();return(\"0\"+(today.getMonth()+1)).slice(-2)+\"-\"+(\"0\"+today.getDate()).slice(-2)+\"-\"+today.getFullYear()+\" \"+(\"0\"+today.getHours()).slice(-2)+\":\"+(\"0\"+today.getMinutes()).slice(-2)+\":\"+(\"0\"+today.getSeconds()).slice(-2)+\"|\"+Math.floor(Math.random()*Math.pow(10,5)).toString().padStart(5,\"0\");}// TODO: consider using just the context instead\n},{key:\"log\",value:function log(inputVal,problemID,step,hint,isCorrect,hintsFinished,eventType,variabilization,lesson,courseName,hintType,dynamicHint,bioInfo){var _step$stepAnswer;if(!DO_LOG_DATA){console.debug(\"Not using firebase for logging (2)\");return;}console.debug(\"trying to log hint: \",hint,\"step\",step);if(Array.isArray(hintsFinished)&&Array.isArray(hintsFinished[0])){hintsFinished=hintsFinished.map(function(step){return step.join(\", \");});}var data={eventType:eventType,problemID:problemID,stepID:step===null||step===void 0?void 0:step.id,hintID:hint===null||hint===void 0?void 0:hint.id,input:inputVal===null||inputVal===void 0?void 0:inputVal.toString(),correctAnswer:step===null||step===void 0?void 0:(_step$stepAnswer=step.stepAnswer)===null||_step$stepAnswer===void 0?void 0:_step$stepAnswer.toString(),isCorrect:isCorrect,hintInput:null,hintAnswer:null,hintIsCorrect:null,hintsFinished:hintsFinished,variabilization:variabilization,lesson:lesson,Content:courseName,knowledgeComponents:step===null||step===void 0?void 0:step.knowledgeComponents,hintType:hintType,dynamicHint:dynamicHint,bioInfo:bioInfo};// return this.writeData(GPTExperimentOutput, data);\nreturn this.writeData(problemSubmissionsOutput,data);}},{key:\"hintLog\",value:function hintLog(hintInput,problemID,step,hint,isCorrect,hintsFinished,variabilization,lesson,courseName,hintType,dynamicHint,bioInfo){var _hint$hintAnswer,_data;if(!DO_LOG_DATA)return;console.debug(\"step\",step);var data=(_data={eventType:\"hintScaffoldLog\",problemID:problemID,stepID:step===null||step===void 0?void 0:step.id,hintID:hint===null||hint===void 0?void 0:hint.id,input:null,correctAnswer:null,isCorrect:null,hintInput:hintInput===null||hintInput===void 0?void 0:hintInput.toString(),hintAnswer:hint===null||hint===void 0?void 0:(_hint$hintAnswer=hint.hintAnswer)===null||_hint$hintAnswer===void 0?void 0:_hint$hintAnswer.toString(),hintIsCorrect:isCorrect,hintsFinished:hintsFinished,dynamicHint:\"abc\",bioInfo:\"abcedf\",variabilization:variabilization,Content:courseName,lesson:lesson,knowledgeComponents:step===null||step===void 0?void 0:step.knowledgeComponents,hintType:hintType},_defineProperty(_data,\"dynamicHint\",dynamicHint),_defineProperty(_data,\"bioInfo\",bioInfo),_data);// return this.writeData(GPTExperimentOutput, data);\nreturn this.writeData(problemSubmissionsOutput,data);}},{key:\"mouseLog\",value:function mouseLog(payload){if(!DO_LOG_DATA||!DO_LOG_MOUSE_DATA)return;if(this.mouseLogBuffer.length>0){if(!(Math.abs(payload.position.x-this.mouseLogBuffer[this.mouseLogBuffer.length-1].x)>GRANULARITY||Math.abs(payload.position.y-this.mouseLogBuffer[this.mouseLogBuffer.length-1].y)>GRANULARITY)){return;}}if(this.mouseLogBuffer.length<MAX_BUFFER_SIZE){this.mouseLogBuffer.push({x:payload.position.x,y:payload.position.y});return;}var data={eventType:\"mouseLog\",_logBufferSize:MAX_BUFFER_SIZE,_logGranularity:GRANULARITY,screenSize:payload.elementDimensions,mousePos:this.mouseLogBuffer};this.mouseLogBuffer=[];console.debug(\"Logged mouseMovement\");return this.writeData(\"mouseMovement\",data);}},{key:\"startedProblem\",value:function startedProblem(problemID,courseName,lesson,lessonObjectives){if(!DO_LOG_DATA)return;console.debug(\"Logging that the problem has been started (\".concat(problemID,\")\"));var data={problemID:problemID,Content:courseName,lesson:lesson,lessonObjectives:lessonObjectives};return this.writeData(problemStartLogOutput,data);}},{key:\"submitSiteLog\",value:function submitSiteLog(logType,logMessage,relevantInformation){var problemID=arguments.length>3&&arguments[3]!==undefined?arguments[3]:\"n/a\";var data={logType:logType,logMessage:logMessage,relevantInformation:relevantInformation,problemID:problemID};return this.writeData(siteLogOutput,data);}},{key:\"submitFocusChange\",value:function submitFocusChange(_focusStatus){var data={focusStatus:_focusStatus};// TODO: oats_user_id is not guaranteed to be unique across users; is this a problem?\nreturn this.pushDataToArr(focusStatus,this.oats_user_id,\"focusHistory\",data,true);}},{key:\"submitFeedback\",value:function submitFeedback(problemID,feedback,problemFinished,variables,courseName,steps,lesson){var data={problemID:problemID,problemFinished:problemFinished,feedback:feedback,lesson:lesson,status:\"open\",Content:courseName,variables:variables,steps:steps.map(function(_ref3){var answerType=_ref3.answerType,id=_ref3.id,stepAnswer=_ref3.stepAnswer,problemType=_ref3.problemType,knowledgeComponents=_ref3.knowledgeComponents;return{answerType:answerType,id:id,stepAnswer:stepAnswer,problemType:problemType,knowledgeComponents:knowledgeComponents};})};return this.writeData(feedbackOutput,data);}}]);return Firebase;}();export default Firebase;","map":{"version":3,"names":["CURRENT_SEMESTER","DO_LOG_DATA","DO_LOG_MOUSE_DATA","ENABLE_FIREBASE","GRANULARITY","MAX_BUFFER_SIZE","initializeApp","arrayUnion","doc","getFirestore","serverTimestamp","setDoc","daysSinceEpoch","IS_PRODUCTION","IS_STAGING_CONTENT","IS_STAGING_OR_DEVELOPMENT","IS_STAGING_PLATFORM","problemSubmissionsOutput","problemStartLogOutput","GPTExperimentOutput","feedbackOutput","siteLogOutput","focusStatus","Firebase","oats_user_id","credentials","treatment","siteVersion","ltiContext","console","debug","app","db","mouseLogBuffer","targetCollection","cond1","includes","cond2","_collection","documentId","arrField","data","doPartitioning","partitionFn","collection","getCollectionName","payload","addMetaData","path","push","toString","docRef","merge","catch","err","log","_getReadableID","isArrayElement","_payload","semester","siteCommitHash","process","env","REACT_APP_COMMIT_HASH","time_stamp","Date","now","REACT_APP_STUDY_ID","study_id","server_time","user_id","course_id","course_name","course_code","lms_user_id","Object","fromEntries","entries","map","key","val","today","getMonth","slice","getDate","getFullYear","getHours","getMinutes","getSeconds","Math","floor","random","pow","padStart","inputVal","problemID","step","hint","isCorrect","hintsFinished","eventType","variabilization","lesson","courseName","hintType","dynamicHint","bioInfo","Array","isArray","join","stepID","id","hintID","input","correctAnswer","stepAnswer","hintInput","hintAnswer","hintIsCorrect","Content","knowledgeComponents","writeData","length","abs","position","x","y","_logBufferSize","_logGranularity","screenSize","elementDimensions","mousePos","lessonObjectives","logType","logMessage","relevantInformation","_focusStatus","pushDataToArr","feedback","problemFinished","variables","steps","status","answerType","problemType"],"sources":["/Users/allisonwang/Downloads/chem-final/OATutor-Chem1A/src/components/Firebase.js"],"sourcesContent":["import {\n    CURRENT_SEMESTER,\n    DO_LOG_DATA,\n    DO_LOG_MOUSE_DATA,\n    ENABLE_FIREBASE,\n    GRANULARITY,\n    MAX_BUFFER_SIZE,\n} from \"../config/config.js\";\n\nimport { initializeApp } from \"firebase/app\";\nimport {\n    arrayUnion,\n    doc,\n    getFirestore,\n    serverTimestamp,\n    setDoc,\n} from \"firebase/firestore\";\nimport daysSinceEpoch from \"../util/daysSinceEpoch\";\nimport {\n    IS_PRODUCTION,\n    IS_STAGING_CONTENT,\n    IS_STAGING_OR_DEVELOPMENT,\n    IS_STAGING_PLATFORM,\n} from \"../util/getBuildType\";\n\nconst problemSubmissionsOutput = \"problemSubmissions\";\nconst problemStartLogOutput = \"problemStartLogs\";\nconst GPTExperimentOutput = \"GPTExperimentOutput\";\nconst feedbackOutput = \"feedbacks\";\nconst siteLogOutput = \"siteLogs\";\nconst focusStatus = \"focusStatus\";\n\nclass Firebase {\n    constructor(oats_user_id, credentials, treatment, siteVersion, ltiContext) {\n        if (!ENABLE_FIREBASE) {\n            console.debug(\"Not using firebase for logging\");\n            return;\n        }\n        const app = initializeApp(credentials);\n\n        this.oats_user_id = oats_user_id;\n        this.db = getFirestore(app);\n        this.treatment = treatment;\n        this.siteVersion = siteVersion;\n        this.mouseLogBuffer = [];\n        this.ltiContext = ltiContext;\n    }\n\n    getCollectionName(targetCollection) {\n        const cond1 =\n            IS_STAGING_CONTENT &&\n            [feedbackOutput, siteLogOutput].includes(targetCollection);\n        const cond2 =\n            IS_STAGING_PLATFORM && [siteLogOutput].includes(targetCollection);\n\n        return targetCollection;\n    }\n\n    /**\n     * Instead of creating a new doc, pushes to an array instead.\n     * @param _collection\n     * @param documentId\n     * @param arrField\n     * @param data\n     * @param doPartitioning partition data into a sub-collection's documents (for large amount of data)\n     * @param partitionFn\n     * @returns {Promise<void>}\n     */\n    async pushDataToArr(\n        _collection,\n        documentId,\n        arrField,\n        data,\n        doPartitioning = false,\n        partitionFn = daysSinceEpoch\n    ) {\n        if (!ENABLE_FIREBASE) return;\n        const collection = this.getCollectionName(_collection);\n        const payload = this.addMetaData(data, true);\n\n        if (IS_STAGING_OR_DEVELOPMENT) {\n            console.debug(`Upserting document: ${documentId}, with ${data}`);\n        }\n\n        const path = [this.db, collection, documentId];\n        if (doPartitioning) {\n            path.push(\"partitions\", partitionFn().toString());\n        }\n        const docRef = doc(...path);\n        await setDoc(\n            docRef,\n            {\n                [arrField]: arrayUnion(payload),\n            },\n            {\n                merge: true,\n            }\n        ).catch((err) => {\n            console.log(\"a non-critical error occurred.\");\n            console.debug(err);\n        });\n    }\n\n    /*\n      Collection: Collection of Key/Value pairs\n      Document: Key - How you will access this data later. Usually username\n      Data: Value - JSON object of data you want to store\n    */\n    async writeData(_collection, data) {\n        if (!ENABLE_FIREBASE) return;\n        const collection = this.getCollectionName(_collection);\n        const payload = this.addMetaData(data);\n\n        if (IS_STAGING_OR_DEVELOPMENT) {\n            // console.log(\"payload: \", payload);\n            console.debug(\"Writing this payload to firebase: \", payload);\n        }\n\n        await setDoc(\n            doc(this.db, collection, this._getReadableID()),\n            payload\n        ).catch((err) => {\n            console.log(\"a non-critical error occurred.\");\n            console.log(\"Error is: \", err);\n            console.debug(err);\n        });\n    }\n\n    /**\n     *\n     * @param data\n     * @param isArrayElement if true, cannot use FieldValue methods like serverTimestamp()\n     * @returns {{[p: string]: *}}\n     */\n    addMetaData(data, isArrayElement = false) {\n        const _payload = {\n            semester: CURRENT_SEMESTER,\n            siteVersion: this.siteVersion,\n            siteCommitHash: process.env.REACT_APP_COMMIT_HASH,\n            oats_user_id: this.oats_user_id,\n            treatment: this.treatment,\n            time_stamp: Date.now(),\n\n            ...(process.env.REACT_APP_STUDY_ID\n                ? {\n                      study_id: process.env.REACT_APP_STUDY_ID,\n                  }\n                : {}),\n\n            ...(!isArrayElement\n                ? {\n                      server_time: serverTimestamp(),\n                  }\n                : {}),\n\n            ...(this.ltiContext?.user_id\n                ? {\n                      course_id: this.ltiContext.course_id,\n                      course_name: this.ltiContext.course_name,\n                      course_code: this.ltiContext.course_code,\n\n                      lms_user_id: this.ltiContext.user_id,\n                  }\n                : {\n                      course_id: \"n/a\",\n                      course_name: \"n/a\",\n                      course_code: \"n/a\",\n\n                      lms_user_id: \"n/a\",\n                  }),\n\n            ...data,\n        };\n        return Object.fromEntries(\n            Object.entries(_payload).map(([key, val]) => [\n                key,\n                typeof val === \"undefined\" ? null : val,\n            ])\n        );\n    }\n\n    _getReadableID() {\n        const today = new Date();\n        return (\n            (\"0\" + (today.getMonth() + 1)).slice(-2) +\n            \"-\" +\n            (\"0\" + today.getDate()).slice(-2) +\n            \"-\" +\n            today.getFullYear() +\n            \" \" +\n            (\"0\" + today.getHours()).slice(-2) +\n            \":\" +\n            (\"0\" + today.getMinutes()).slice(-2) +\n            \":\" +\n            (\"0\" + today.getSeconds()).slice(-2) +\n            \"|\" +\n            Math.floor(Math.random() * Math.pow(10, 5))\n                .toString()\n                .padStart(5, \"0\")\n        );\n    }\n\n    // TODO: consider using just the context instead\n    log(\n        inputVal,\n        problemID,\n        step,\n        hint,\n        isCorrect,\n        hintsFinished,\n        eventType,\n        variabilization,\n        lesson,\n        courseName,\n        hintType,\n        dynamicHint,\n        bioInfo\n    ) {\n        if (!DO_LOG_DATA) {\n            console.debug(\"Not using firebase for logging (2)\");\n            return;\n        }\n        console.debug(\"trying to log hint: \", hint, \"step\", step);\n        if (Array.isArray(hintsFinished) && Array.isArray(hintsFinished[0])) {\n            hintsFinished = hintsFinished.map((step) => step.join(\", \"));\n        }\n        const data = {\n            eventType: eventType,\n            problemID: problemID,\n            stepID: step?.id,\n            hintID: hint?.id,\n            input: inputVal?.toString(),\n            correctAnswer: step?.stepAnswer?.toString(),\n            isCorrect,\n            hintInput: null,\n            hintAnswer: null,\n            hintIsCorrect: null,\n            hintsFinished,\n            variabilization,\n            lesson,\n            Content: courseName,\n            knowledgeComponents: step?.knowledgeComponents,\n            hintType,\n            dynamicHint,\n            bioInfo,\n        };\n        // return this.writeData(GPTExperimentOutput, data);\n        return this.writeData(problemSubmissionsOutput, data);\n    }\n\n    hintLog(\n        hintInput,\n        problemID,\n        step,\n        hint,\n        isCorrect,\n        hintsFinished,\n        variabilization,\n        lesson,\n        courseName,\n        hintType,\n        dynamicHint,\n        bioInfo\n    ) {\n        if (!DO_LOG_DATA) return;\n        console.debug(\"step\", step);\n        const data = {\n            eventType: \"hintScaffoldLog\",\n            problemID,\n            stepID: step?.id,\n            hintID: hint?.id,\n            input: null,\n            correctAnswer: null,\n            isCorrect: null,\n            hintInput: hintInput?.toString(),\n            hintAnswer: hint?.hintAnswer?.toString(),\n            hintIsCorrect: isCorrect,\n            hintsFinished,\n            dynamicHint: \"abc\",\n            bioInfo: \"abcedf\",\n            variabilization,\n            Content: courseName,\n            lesson,\n            knowledgeComponents: step?.knowledgeComponents,\n            hintType,\n            dynamicHint,\n            bioInfo,\n        };\n        // return this.writeData(GPTExperimentOutput, data);\n        return this.writeData(problemSubmissionsOutput, data);\n    }\n\n    mouseLog(payload) {\n        if (!DO_LOG_DATA || !DO_LOG_MOUSE_DATA) return;\n        if (this.mouseLogBuffer.length > 0) {\n            if (\n                !(\n                    Math.abs(\n                        payload.position.x -\n                            this.mouseLogBuffer[this.mouseLogBuffer.length - 1]\n                                .x\n                    ) > GRANULARITY ||\n                    Math.abs(\n                        payload.position.y -\n                            this.mouseLogBuffer[this.mouseLogBuffer.length - 1]\n                                .y\n                    ) > GRANULARITY\n                )\n            ) {\n                return;\n            }\n        }\n        if (this.mouseLogBuffer.length < MAX_BUFFER_SIZE) {\n            this.mouseLogBuffer.push({\n                x: payload.position.x,\n                y: payload.position.y,\n            });\n            return;\n        }\n        const data = {\n            eventType: \"mouseLog\",\n            _logBufferSize: MAX_BUFFER_SIZE,\n            _logGranularity: GRANULARITY,\n            screenSize: payload.elementDimensions,\n            mousePos: this.mouseLogBuffer,\n        };\n        this.mouseLogBuffer = [];\n        console.debug(\"Logged mouseMovement\");\n        return this.writeData(\"mouseMovement\", data);\n    }\n\n    startedProblem(problemID, courseName, lesson, lessonObjectives) {\n        if (!DO_LOG_DATA) return;\n        console.debug(\n            `Logging that the problem has been started (${problemID})`\n        );\n        const data = {\n            problemID,\n            Content: courseName,\n            lesson,\n            lessonObjectives,\n        };\n        return this.writeData(problemStartLogOutput, data);\n    }\n\n    submitSiteLog(logType, logMessage, relevantInformation, problemID = \"n/a\") {\n        const data = {\n            logType,\n            logMessage,\n            relevantInformation,\n            problemID,\n        };\n        return this.writeData(siteLogOutput, data);\n    }\n\n    submitFocusChange(_focusStatus) {\n        const data = {\n            focusStatus: _focusStatus,\n        };\n\n        // TODO: oats_user_id is not guaranteed to be unique across users; is this a problem?\n        return this.pushDataToArr(\n            focusStatus,\n            this.oats_user_id,\n            \"focusHistory\",\n            data,\n            true\n        );\n    }\n\n    submitFeedback(\n        problemID,\n        feedback,\n        problemFinished,\n        variables,\n        courseName,\n        steps,\n        lesson\n    ) {\n        const data = {\n            problemID,\n            problemFinished,\n            feedback,\n            lesson,\n            status: \"open\",\n            Content: courseName,\n            variables,\n            steps: steps.map(\n                ({\n                    answerType,\n                    id,\n                    stepAnswer,\n                    problemType,\n                    knowledgeComponents,\n                }) => ({\n                    answerType,\n                    id,\n                    stepAnswer,\n                    problemType,\n                    knowledgeComponents,\n                })\n            ),\n        };\n        return this.writeData(feedbackOutput, data);\n    }\n}\n\nexport default Firebase;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}